-- DATABASE CHARACTER SET 변경
CREATE DATABASE product
CHARACTER SET utf8mb4
COLLATE utf8mb4_unicode_ci;

-- CATEGORY 테이블 정의: 상품 카테고리 정보를 저장합니다.
CREATE TABLE product.CATEGORY (
    CATEGORY_ID BIGINT(20) UNSIGNED AUTO_INCREMENT PRIMARY KEY COMMENT '카테고리 고유 ID',
    NAME VARCHAR(50) NOT NULL COMMENT '카테고리명 (예: 음료, 디저트 등)',
    IS_DELETED CHAR(1) DEFAULT 'N' COMMENT '삭제 여부 (N: 사용 중, Y: 삭제)',
    CREATED_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT '생성 시간'
) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci COMMENT = '상품 카테고리 정보를 저장하는 테이블';

-- OPTION_GROUP 테이블 정의: 옵션 그룹 정보를 저장합니다.
CREATE TABLE product.OPTION_GROUP (
    OPTION_GROUP_ID BIGINT(20) UNSIGNED AUTO_INCREMENT PRIMARY KEY COMMENT '옵션 그룹 고유 ID',
    NAME VARCHAR(100) NOT NULL COMMENT '옵션 그룹명 (예: 사이즈 옵션 등)',
    IS_REQUIRED CHAR(1) DEFAULT 'Y' COMMENT '옵션 필수 여부 (Y: 필수, N: 선택)',
    MIN_COUNT INT UNSIGNED DEFAULT 1 COMMENT '옵션 최소 개수',
    MAX_COUNT INT UNSIGNED DEFAULT 1 COMMENT '옵션 최대 개수',
    IS_DELETED CHAR(1) DEFAULT 'N' COMMENT '삭제 여부 (N: 사용 중, Y: 삭제)',
    CREATED_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT '생성 시간'
) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci COMMENT = '옵션 그룹 정보를 저장하는 테이블';

-- OPTION 테이블 정의: 옵션 정보를 저장하며 OPTION_GROUP과 연관관계를 가집니다.
CREATE TABLE product.OPTION (
    OPTION_ID BIGINT(20) UNSIGNED AUTO_INCREMENT PRIMARY KEY COMMENT '옵션 고유 ID',
    NAME VARCHAR(50) NOT NULL COMMENT '옵션명 (예: HOT/ICE, 샷 추가 등)',
    ADDITIONAL_PRICE DECIMAL(10, 2) DEFAULT 0 COMMENT '옵션 추가 가격',
    OPTION_GROUP_ID BIGINT(20) UNSIGNED NOT NULL COMMENT '옵션 그룹 ID',
    IS_DELETED CHAR(1) DEFAULT 'N' COMMENT '삭제 여부 (N: 사용 중, Y: 삭제)',
    CREATED_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT '생성 시간',
    FOREIGN KEY (OPTION_GROUP_ID) REFERENCES OPTION_GROUP(OPTION_GROUP_ID)
) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci COMMENT = '옵션 정보를 저장하는 테이블';


-- PRODUCT 테이블 정의: 옵션 그룹과 카테고리를 참조합니다.
CREATE TABLE product.PRODUCT (
  PRODUCT_ID BIGINT(20) UNSIGNED NOT NULL AUTO_INCREMENT COMMENT '상품 고유 ID',
  NAME VARCHAR(100) NOT NULL COMMENT '상품명 (예: 아이스 아메리카노, 카페라떼)',
  PRICE DECIMAL(10,2) NOT NULL COMMENT '상품 가격',
  CATEGORY_ID BIGINT(20) UNSIGNED NOT NULL COMMENT '카테고리 ID (CATEGORY 테이블의 CATEGORY_ID를 참조)',
  OPTION_GROUP_ID BIGINT(20) UNSIGNED DEFAULT NULL COMMENT '옵션 그룹 ID (OPTION_GROUP 테이블의 OPTION_GROUP_ID를 참조)',
  COLOR VARCHAR(50) NOT NULL COMMENT '상품 색상',
  IS_TAX_INCLUDED CHAR(1) DEFAULT 'Y' COMMENT '부가세 포함 여부 (Y: 포함, N: 미포함)',
  STATUS VARCHAR(20) DEFAULT 'AVAILABLE' COMMENT '상품 상태 (판매 가능 여부 AVAILABLE: 사용가능, SOLD_OUT: 품절)',
  IS_DELETED CHAR(1) DEFAULT 'N' COMMENT '삭제 여부 (N: 사용 중, Y: 삭제)',
  CREATED_AT TIMESTAMP NULL DEFAULT CURRENT_TIMESTAMP COMMENT '생성 시간',
  UPDATED_AT TIMESTAMP NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '수정 시간',
  PRIMARY KEY (PRODUCT_ID),
  FOREIGN KEY (CATEGORY_ID) REFERENCES product.CATEGORY(CATEGORY_ID),
  FOREIGN KEY (OPTION_GROUP_ID) REFERENCES product.OPTION_GROUP(OPTION_GROUP_ID) ON DELETE SET NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='상품의 기본 정보를 저장하는 테이블';

CREATE DATABASE `order`
CHARACTER SET utf8mb4
COLLATE utf8mb4_unicode_ci;

-- CUSTOMER 테이블 정의: 고객 정보를 저장합니다. (db member 새로 만드는게...)
CREATE TABLE order.CUSTOMER (
    CUSTOMER_ID BIGINT(20) UNSIGNED AUTO_INCREMENT PRIMARY KEY COMMENT '고객 고유 ID',
    NAME VARCHAR(100) NOT NULL COMMENT '고객 이름',
    PHONE VARCHAR(20) NOT NULL COMMENT '고객 전화번호',
    EMAIL VARCHAR(100) COMMENT '고객 이메일 주소',
    CREATED_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT '고객 등록 시간'
) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci COMMENT = '고객 정보를 저장하는 테이블';

-- DISCOUNT 테이블 정의: 할인 정보를 저장합니다.
CREATE TABLE order.DISCOUNT (
    DISCOUNT_ID BIGINT(20) UNSIGNED AUTO_INCREMENT PRIMARY KEY COMMENT '할인 고유 ID',
    DISCOUNT_TYPE VARCHAR(20) NOT NULL COMMENT '할인 유형 (PER: % 할인, FIX: 정액 할인)',
    DISCOUNT_VALUE DECIMAL(10, 2) NOT NULL COMMENT '할인 값 (예: 10%이면 10, 정액 할인 5000원)'
) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci COMMENT = '할인 정보를 저장하는 테이블';

-- ORDER 테이블 정의: 주문의 기본 정보를 저장하며 DISCOUNT 테이블을 참조합니다.
CREATE TABLE order.ORDER (
    ORDER_ID BIGINT(20) UNSIGNED AUTO_INCREMENT PRIMARY KEY COMMENT '주문 고유 ID',
    ORDER_DATE TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT '주문 시간',
    CUSTOMER_ID BIGINT(20) UNSIGNED NOT NULL COMMENT '고객 ID',
    PAYMENT_TYPE VARCHAR(20) NOT NULL COMMENT '결제 타입 (예: 카드, 현금, 포인트)',
    ORDER_STATUS VARCHAR(20) DEFAULT 'PENDING' COMMENT '주문 상태 (예: PENDING, COMPLETED, CANCELED)',
    DISCOUNT_ID BIGINT(20) UNSIGNED COMMENT '할인 ID (DISCOUNT 테이블의 DISCOUNT_ID를 참조)',
    TOTAL_AMOUNT DECIMAL(10, 2) NOT NULL COMMENT '총 주문 금액',
    IS_DELETED CHAR(1) DEFAULT 'N' COMMENT '삭제 여부 (N: 사용 중, Y: 삭제)',
    CREATED_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT '생성 시간',
    UPDATED_AT TIMESTAMP NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '수정 시간',
    FOREIGN KEY (DISCOUNT_ID) REFERENCES order.DISCOUNT(DISCOUNT_ID) ON DELETE SET NULL
) CHARACTER SET utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT = '주문 기본 정보를 저장하는 테이블';

-- ORDER_ITEM 테이블 정의: 주문에 포함된 개별 상품 정보를 저장합니다.
CREATE TABLE order.ORDER_ITEM (
    ORDER_ITEM_ID BIGINT(20) UNSIGNED AUTO_INCREMENT PRIMARY KEY COMMENT '주문 항목 고유 ID',
    ORDER_ID BIGINT(20) UNSIGNED NOT NULL COMMENT '주문 ID (ORDER 테이블의 ORDER_ID를 참조)',
    PRODUCT_ID BIGINT(20) UNSIGNED NOT NULL COMMENT '상품 ID (PRODUCT 테이블의 PRODUCT_ID를 참조)',
    PRODUCT_NAME VARCHAR(100) NOT NULL COMMENT '상품명 (예: 아이스 아메리카노, 카페라떼)',
    QUANTITY INT UNSIGNED NOT NULL COMMENT '주문 수량',
    UNIT_PRICE DECIMAL(10, 2) NOT NULL COMMENT '단가',
    ORDER_STATUS VARCHAR(20) DEFAULT 'PENDING' COMMENT '주문 상태 (예: PENDING, COMPLETED, CANCELED)',
    TOTAL_PRICE DECIMAL(10, 2) AS (QUANTITY * UNIT_PRICE) COMMENT '주문 항목 총 가격',
    DISCOUNT_AMOUNT DECIMAL(10, 2) DEFAULT 0 COMMENT '할인 금액',
    IS_DELETED CHAR(1) DEFAULT 'N' COMMENT '삭제 여부 (N: 사용 중, Y: 삭제)',
    FOREIGN KEY (ORDER_ID) REFERENCES order.ORDER(ORDER_ID) ON DELETE CASCADE
) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci COMMENT = '주문에 포함된 개별 상품 정보를 저장하는 테이블';

-- ORDER_ITEM_OPTION 테이블 정의: 주문 항목에 포함된 옵션 정보를 저장합니다.
CREATE TABLE order.ORDER_ITEM_OPTION (
    ORDER_ITEM_OPTION_ID BIGINT(20) UNSIGNED AUTO_INCREMENT PRIMARY KEY COMMENT '주문 항목 옵션 고유 ID',
    ORDER_ITEM_ID BIGINT(20) UNSIGNED NOT NULL COMMENT '주문 항목 ID (ORDER_ITEM 테이블의 ORDER_ITEM_ID를 참조)',
    OPTION_ID BIGINT(20) UNSIGNED NOT NULL COMMENT '옵션 ID (OPTION 테이블의 OPTION_ID를 참조)',
    OPTION_NAME VARCHAR(100) NOT NULL COMMENT '상품명 (예: 아이스 아메리카노, 카페라떼)',
    OPTION_PRICE DECIMAL(10, 2) DEFAULT 0 COMMENT '옵션 가격',
    IS_DELETED CHAR(1) DEFAULT 'N' COMMENT '삭제 여부 (N: 사용 중, Y: 삭제)',
    FOREIGN KEY (ORDER_ITEM_ID) REFERENCES order.ORDER_ITEM(ORDER_ITEM_ID) ON DELETE CASCADE
) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci COMMENT = '주문 항목의 옵션 정보를 저장하는 테이블';